(()=>{"use strict";var e=document.querySelector("#card-template").content;function t(e){e.classList.toggle("card__like-button_is-active")}function n(e){e.classList.add("popup_is-opened"),document.addEventListener("keyup",r),document.addEventListener("mousedown",c),document.addEventListener("mouseup",u)}function o(e){e.classList.remove("popup_is-opened"),document.removeEventListener("keyup",r),document.removeEventListener("mousedown",c),document.removeEventListener("mouseup",u)}function r(e){"Escape"===e.key&&o(document.querySelector(".popup_is-opened"))}function c(e){e.target.classList.contains("popup_is-opened")&&(e.target.isClickOnThis=!0)}function u(e){e.target.isClickOnThis&&e.target.classList.contains("popup_is-opened")&&(e.preventDefault(),o(e.target)),e.target.isClickOnThis=!1}var a=function(e,t,n){var o=e.querySelector(".".concat(t.id,"-error"));t.classList.remove(n.inputErrorClass),o.classList.remove(n.errorClass),o.textContent=""},i=function(e,t,n){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?(t.disabled=!1,t.classList.remove(n.inactiveButtonClass)):(t.disabled=!0,t.classList.add(n.inactiveButtonClass))},s={baseUrl:"https://nomoreparties.co/v1/wff-cohort-27",headers:{authorization:"78d647ac-c117-4622-a9f8-fa9f9240e132","Content-Type":"application/json"}},l=new Promise((function(e,t){fetch("".concat(s.baseUrl,"/cards"),{method:"GET",headers:s.headers}).then((function(n){n.ok?e(n.json()):t("Что-то пошло не так: ".concat(n.status))})).catch((function(e){console.log(e)}))})),d=new Promise((function(e,t){fetch("".concat(s.baseUrl,"/users/me"),{method:"GET",headers:s.headers}).then((function(n){n.ok?e(n.json()):t("Что-то пошло не так: ".concat(n.status))})).catch((function(e){console.log(e)}))})),p=document.querySelector(".profile__edit-button"),_=document.querySelector(".popup_type_edit"),m=document.querySelector(".popup__input_type_name"),f=document.querySelector(".popup__input_type_description"),y=document.querySelector(".popup__input_type_card-name"),v=document.querySelector(".popup__input_type_url"),h=document.querySelector(".popup__input_type_url_avatar"),S=document.querySelector(".profile__image-avtar-edit"),g=document.querySelector(".profile__add-button"),q=document.querySelector(".popup_type_new-card"),b=document.querySelector(".popup_type_edit_avatar"),E=document.querySelector(".popup_type_edit .popup__close"),k=document.querySelector(".popup_type_new-card .popup__close"),L=document.querySelector(".popup_type_image .popup__close"),C=document.querySelector(".popup_type_edit_avatar .popup__close"),x=document.querySelector(".popup_type_image"),T=document.querySelector('[name="new-place"]'),A=document.querySelector('[name="edit-profile"]'),U=document.querySelector('[name="edit-avatar"]'),j=document.querySelector(".profile__title"),w=document.querySelector(".profile__description"),O=document.querySelector(".profile__image"),P=document.querySelector(".places__list"),B=null,D=function(e){var n=e.currentTarget,o=n.targetElement,r=o.getAttribute("id");r=r.replace(/^card/,"");var c=null;c=n.classList.contains("card__like-button_is-active")?function(e){return fetch("".concat(s.baseUrl,"/cards/likes/").concat(e),{method:"DELETE",headers:s.headers}).then((function(e){if(e.ok)return e.json()})).catch((function(e){console.log(e)}))}(r):function(e){return fetch("".concat(s.baseUrl,"/cards/likes/").concat(e),{method:"PUT",headers:s.headers}).then((function(e){if(e.ok)return e.json()})).catch((function(e){console.log(e)}))}(r),c.then((function(e){o.querySelector(".card__like-quantity").textContent=e.likes.length})),function(e){t(e.currentTarget)}(e)},N=function(e){var t=e.currentTarget.targetElement.getAttribute("id");(function(e){fetch("".concat(s.baseUrl,"/cards/").concat(e),{method:"DELETE",headers:s.headers}).then((function(e){if(e.ok)return e.json()})).catch((function(e){console.log(e)}))})(t=t.replace(/^card/,"")),function(e){e.currentTarget.targetElement.remove()}(e)},J=function(n,o){return function(n,o,r,c,u){var a=e.querySelector(".card").cloneNode(!0),i=a.querySelector(".card__delete-button"),s=a.querySelector(".card__like-button"),l=a.querySelector(".card__image");return n.owner._id==o&&i.classList.add("card__delete-button-visible"),a.querySelector(".card__like-quantity").textContent=n.likes.length,o&&n.likes.some((function(e){return e._id==o}))&&t(s),i.addEventListener("click",r),i.targetElement=a,a.querySelector(".card__title").textContent=n.name,l.setAttribute("alt",n.name),l.setAttribute("src",n.link),a.setAttribute("id","card".concat(n._id)),l.addEventListener("click",u),s.addEventListener("click",c),s.targetElement=a,a}(n,o,N,D,H)},G={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_inactive",inputErrorClass:"popup__input_type_error",errorClass:"form__input-error_active"};function H(e){x.querySelector(".popup__image").removeAttribute("src"),x.querySelector(".popup__caption").textContent=e.target.parentElement.querySelector(".card__title").textContent,x.querySelector(".popup__image").setAttribute("src",e.target.src),x.querySelector(".popup__image").setAttribute("alt",e.target.alt),n(x)}!function(e){Array.from(document.querySelectorAll(e.formSelector)).forEach((function(t){!function(e,t){var n=Array.from(e.querySelectorAll(t.inputSelector)),o=e.querySelector(t.submitButtonSelector);n.forEach((function(r){r.addEventListener("input",(function(){!function(e,t,n){t.validity.valid?a(e,t,n):function(e,t,n){var o=e.querySelector(".".concat(t.id,"-error"));t.classList.add(n.inputErrorClass);var r=t.validationMessage;t.validity.patternMismatch&&t.getAttribute("data-pattern-mismatch-message")&&(r=t.getAttribute("data-pattern-mismatch-message")),o.textContent=r,o.classList.add(n.errorClass)}(e,t,n)}(e,r,t),i(n,o,t)}))}))}(t,e)}))}(G),S.addEventListener("click",(function(){n(b)})),p.addEventListener("click",(function(){m.value=j.textContent,f.value=w.textContent,n(_),function(e,t){var n=Array.from(e.querySelectorAll(t.inputSelector)),o=e.querySelector(t.submitButtonSelector);n.forEach((function(n){a(e,n,t)})),i(n,o,t)}(A,G)})),U.addEventListener("submit",(function(e){e.preventDefault();var t,n=h.value,r=e.currentTarget.querySelector(".popup__button");r.textContent="Сохранение...",(t=n,fetch("".concat(s.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:s.headers,body:JSON.stringify({avatar:t})}).then((function(e){if(e.ok)return e.json()})).catch((function(e){console.log(e)}))).then((function(e){O.style.backgroundImage="url(".concat(e.avatar,")"),U.reset(),r.textContent="Сохранить",o(b)}))})),A.addEventListener("submit",(function(e){e.preventDefault();var t,n,r=m.value,c=f.value,u=e.currentTarget.querySelector(".popup__button");u.textContent="Сохранение...",(t=r,n=c,fetch("".concat(s.baseUrl,"/users/me"),{method:"PATCH",headers:s.headers,body:JSON.stringify({name:t,about:n})}).then((function(e){if(e.ok)return e.json()})).catch((function(e){console.log(e)}))).then((function(e){j.textContent=e.name,w.textContent=e.about,u.textContent="Сохранить",o(_)}))})),T.addEventListener("submit",(function(e){e.preventDefault();var t,n,r=y.value,c=v.value,u=e.currentTarget.querySelector(".popup__button");u.textContent="Сохранение...",console.log(r,c),(t=r,n=c,fetch("".concat(s.baseUrl,"/cards"),{method:"POST",headers:s.headers,body:JSON.stringify({name:t,link:n})}).then((function(e){if(e.ok)return e.json()})).catch((function(e){console.log(e)}))).then((function(e){P.prepend(J(e,B)),T.reset(),u.textContent="Сохранить",o(q)}))})),g.addEventListener("click",(function(){n(q)})),C.addEventListener("click",(function(){o(b)})),E.addEventListener("click",(function(){o(_)})),k.addEventListener("click",(function(){o(q)})),L.addEventListener("click",(function(){o(x)})),Promise.all([l,d]).then((function(e){j.textContent=e[1].name,w.textContent=e[1].about,O.style.backgroundImage="url('".concat(e[1].avatar,"')"),B=e[1]._id,e[0].forEach((function(e){P.append(J(e,B))}))}))})();